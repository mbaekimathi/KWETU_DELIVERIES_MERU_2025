<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KWETU DELIVERIES - Dashboard{% endblock %}</title>
    
    <!-- TailwindCSS CDN -->
    <!-- Note: CDN is used for development. For production, install Tailwind CSS as a PostCSS plugin -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind CDN production warning
        if (window.console && console.warn) {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                if (args[0] && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) {
                    return; // Suppress Tailwind CDN warning
                }
                originalWarn.apply(console, args);
            };
        }
    </script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    {% block extra_head %}{% endblock %}
</head>
<body class="dashboard-body" data-role="{{ session.get('employee_role', 'KWETU_EMPLOYEE') }}">
    <!-- Main Content Wrapper -->
    <div class="dashboard-main-wrapper">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar" id="dashboard-sidebar">
            <nav class="sidebar-nav">
                <div class="sidebar-nav-section">
                    {% if not is_settings_page|default(false) %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">Main Menu</span>
                        {% block sidebar_nav %}
                        {% set current_role = session.get('employee_role', 'KWETU_EMPLOYEE')|lower|replace('kwetu_', '') %}
                        {% set role_url = current_role %}
                        
                        <a href="/dashboard/{{ role_url }}" class="sidebar-nav-item" id="nav-dashboard">
                            <div class="nav-item-icon">
                                <i class="fas fa-home"></i>
                            </div>
                            <span class="nav-item-text">Dashboard</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        
                        <a href="/dashboard/profile" class="sidebar-nav-item" id="nav-profile">
                            <div class="nav-item-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <span class="nav-item-text">My Profile</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        
                        <a href="/dashboard/settings" class="sidebar-nav-item" id="nav-settings">
                            <div class="nav-item-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                            <span class="nav-item-text">Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        {% endblock %}
                    </div>
                    
                    {% if session.get('employee_role') == 'KWETU_ADMIN' %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">Administration</span>
                        <a href="/dashboard/admin/orders-management" class="sidebar-nav-item" id="nav-orders-management">
                            <div class="nav-item-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <span class="nav-item-text">Orders Management</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/admin/shop-management" class="sidebar-nav-item" id="nav-shop-management">
                            <div class="nav-item-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <span class="nav-item-text">Shop Management</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/admin/hr-management" class="sidebar-nav-item" id="nav-hr-management">
                            <div class="nav-item-icon">
                                <i class="fas fa-users-cog"></i>
                            </div>
                            <span class="nav-item-text">Company HR Management</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/admin/analytics" class="sidebar-nav-item" id="nav-analytics">
                            <div class="nav-item-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <span class="nav-item-text">Company Analytics</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/admin/customer-care" class="sidebar-nav-item" id="nav-customer-care">
                            <div class="nav-item-icon">
                                <i class="fas fa-headset"></i>
                            </div>
                            <span class="nav-item-text">Customer Care</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/admin/settings" class="sidebar-nav-item" id="nav-company-settings">
                            <div class="nav-item-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                            <span class="nav-item-text">Company Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    {% endif %}
                    
                    {% if is_settings_page|default(false) and session.get('employee_role') == 'KWETU_ADMIN' %}
                    <div class="sidebar-nav-group" id="settings-sidebar-nav">
                        <span class="nav-group-label">Settings Sections</span>
                        <a href="javascript:void(0);" class="sidebar-nav-item settings-nav-link active" data-settings-section="company" id="nav-company-settings-sidebar">
                            <div class="nav-item-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                            <span class="nav-item-text">Company Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="javascript:void(0);" class="sidebar-nav-item settings-nav-link" data-settings-section="orders" id="nav-orders-settings-sidebar">
                            <div class="nav-item-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <span class="nav-item-text">Orders Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="javascript:void(0);" class="sidebar-nav-item settings-nav-link" data-settings-section="payment" id="nav-payment-settings-sidebar">
                            <div class="nav-item-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <span class="nav-item-text">Payment Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="javascript:void(0);" class="sidebar-nav-item settings-nav-link" data-settings-section="shop" id="nav-shop-settings-sidebar">
                            <div class="nav-item-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <span class="nav-item-text">Shop Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="javascript:void(0);" class="sidebar-nav-item settings-nav-link" data-settings-section="delivery" id="nav-delivery-settings-sidebar">
                            <div class="nav-item-icon">
                                <i class="fas fa-truck"></i>
                            </div>
                            <span class="nav-item-text">Delivery Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="javascript:void(0);" class="sidebar-nav-item settings-nav-link" data-settings-section="notifications" id="nav-notifications-settings-sidebar">
                            <div class="nav-item-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <span class="nav-item-text">Notifications Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="javascript:void(0);" class="sidebar-nav-item settings-nav-link" data-settings-section="hr" id="nav-hr-settings-sidebar">
                            <div class="nav-item-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <span class="nav-item-text">HR Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="javascript:void(0);" class="sidebar-nav-item settings-nav-link" data-settings-section="general" id="nav-general-settings-sidebar">
                            <div class="nav-item-icon">
                                <i class="fas fa-sliders-h"></i>
                            </div>
                            <span class="nav-item-text">General Settings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    
                    {% if not is_settings_page|default(false) %}
                    {% if session.get('employee_role') == 'KWETU_MANAGER' %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">Management</span>
                        <a href="/dashboard/manager/orders" class="sidebar-nav-item" id="nav-orders">
                            <div class="nav-item-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <span class="nav-item-text">Orders</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/manager/riders" class="sidebar-nav-item" id="nav-riders">
                            <div class="nav-item-icon">
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <span class="nav-item-text">Riders</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/manager/reports" class="sidebar-nav-item" id="nav-reports">
                            <div class="nav-item-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <span class="nav-item-text">Reports</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    {% if session.get('employee_role') == 'KWETU_CASHIER' %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">Cashier</span>
                        <a href="/dashboard/cashier/transactions" class="sidebar-nav-item" id="nav-transactions">
                            <div class="nav-item-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <span class="nav-item-text">Transactions</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/cashier/payments" class="sidebar-nav-item" id="nav-payments">
                            <div class="nav-item-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <span class="nav-item-text">Payments</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/cashier/reports" class="sidebar-nav-item" id="nav-reports">
                            <div class="nav-item-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <span class="nav-item-text">Daily Reports</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    {% if session.get('employee_role') == 'KWETU_SALES' %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">Sales</span>
                        <a href="/dashboard/sales/orders" class="sidebar-nav-item" id="nav-orders">
                            <div class="nav-item-icon">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <span class="nav-item-text">Orders</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/sales/customers" class="sidebar-nav-item" id="nav-customers">
                            <div class="nav-item-icon">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <span class="nav-item-text">Customers</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/sales/products" class="sidebar-nav-item" id="nav-products">
                            <div class="nav-item-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <span class="nav-item-text">Products</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    {% if session.get('employee_role') == 'KWETU_RIDER' %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">Delivery</span>
                        <a href="/dashboard/rider/deliveries" class="sidebar-nav-item" id="nav-deliveries">
                            <div class="nav-item-icon">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                            <span class="nav-item-text">My Deliveries</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/rider/available" class="sidebar-nav-item" id="nav-available">
                            <div class="nav-item-icon">
                                <i class="fas fa-list"></i>
                            </div>
                            <span class="nav-item-text">Available Orders</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/rider/history" class="sidebar-nav-item" id="nav-history">
                            <div class="nav-item-icon">
                                <i class="fas fa-history"></i>
                            </div>
                            <span class="nav-item-text">Delivery History</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/rider/earnings" class="sidebar-nav-item" id="nav-earnings">
                            <div class="nav-item-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <span class="nav-item-text">Earnings</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    {% if session.get('employee_role') == 'KWETU_CUSTOMERCARE' %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">Customer Care</span>
                        <a href="/dashboard/customercare/tickets" class="sidebar-nav-item" id="nav-tickets">
                            <div class="nav-item-icon">
                                <i class="fas fa-ticket-alt"></i>
                            </div>
                            <span class="nav-item-text">Support Tickets</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/customercare/chats" class="sidebar-nav-item" id="nav-chats">
                            <div class="nav-item-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <span class="nav-item-text">Live Chats</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/customercare/complaints" class="sidebar-nav-item" id="nav-complaints">
                            <div class="nav-item-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <span class="nav-item-text">Complaints</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    {% if session.get('employee_role') == 'KWETU_TECHNICIAN' %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">Technical</span>
                        <a href="/dashboard/technician/tasks" class="sidebar-nav-item" id="nav-tasks">
                            <div class="nav-item-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <span class="nav-item-text">Tasks</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/technician/maintenance" class="sidebar-nav-item" id="nav-maintenance">
                            <div class="nav-item-icon">
                                <i class="fas fa-wrench"></i>
                            </div>
                            <span class="nav-item-text">Maintenance</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/technician/inventory" class="sidebar-nav-item" id="nav-inventory">
                            <div class="nav-item-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <span class="nav-item-text">Inventory</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    {% if session.get('employee_role') == 'KWETU_IT_SUPPORT' %}
                    <div class="sidebar-nav-group">
                        <span class="nav-group-label">IT Support</span>
                        <a href="/dashboard/it-support/tickets" class="sidebar-nav-item" id="nav-tickets">
                            <div class="nav-item-icon">
                                <i class="fas fa-headset"></i>
                            </div>
                            <span class="nav-item-text">Support Tickets</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/it-support/systems" class="sidebar-nav-item" id="nav-systems">
                            <div class="nav-item-icon">
                                <i class="fas fa-server"></i>
                            </div>
                            <span class="nav-item-text">Systems</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                        <a href="/dashboard/it-support/users" class="sidebar-nav-item" id="nav-users">
                            <div class="nav-item-icon">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <span class="nav-item-text">User Management</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                    {% endif %}
                    {% endif %}
                    
                    <div class="sidebar-nav-group" style="margin-top: auto; padding-top: 2rem; border-top: 1px solid rgba(0, 0, 0, 0.08);">
                        <a href="/api/logout" class="sidebar-nav-item sidebar-logout-item">
                            <div class="nav-item-icon">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <span class="nav-item-text">Logout</span>
                            <div class="nav-item-indicator"></div>
                        </a>
                    </div>
                </div>
            </nav>
        </aside>
        
        <!-- Sidebar Overlay (Mobile) -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-container">
                <div class="header-left-section">
                    <button class="sidebar-toggle-btn header-sidebar-toggle" id="sidebar-toggle-btn" aria-label="Toggle sidebar">
                        <i class="fas fa-bars" id="sidebar-toggle-icon"></i>
                    </button>
                    <div class="header-logo-section">
                        <div class="header-logo">
                            <span>K</span>
                        </div>
                        <div class="header-brand-text">
                            <h1 class="header-brand-name">KWETU</h1>
                            <p class="header-brand-tagline">DELIVERIES</p>
                        </div>
                    </div>
                    <div class="header-breadcrumb-nav">
                        {% block breadcrumb %}
                        <span class="breadcrumb-item">Dashboard</span>
                        {% endblock %}
                    </div>
                </div>
                
                <div class="header-right-section">
                    <!-- Notifications -->
                    <button class="header-action-btn notifications-btn" id="notifications-btn" aria-label="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    
                    <!-- User Profile Dropdown -->
                    <div class="user-profile-menu">
                        <button id="profile-dropdown-btn" class="profile-menu-trigger" aria-label="User menu">
                            <div class="profile-avatar-wrapper">
                                {% if session.get('employee_profile_picture') %}
                                    {% set profile_img = session.get('employee_profile_picture') %}
                                    {% if profile_img.startswith('uploads/') %}
                                        {% set profile_img_path = profile_img %}
                                    {% elif profile_img.startswith('profiles/') %}
                                        {% set profile_img_path = 'uploads/' + profile_img %}
                                    {% else %}
                                        {% set profile_img_path = 'uploads/profiles/' + profile_img %}
                                    {% endif %}
                                    <img src="{{ url_for('static', filename=profile_img_path) }}" alt="Profile" id="header-profile-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="avatar-placeholder" style="display: none;">
                                        <i class="fas fa-user"></i>
                                    </div>
                                {% else %}
                                    <div class="avatar-placeholder">
                                        <i class="fas fa-user"></i>
                                    </div>
                                {% endif %}
                                <div class="avatar-status-indicator"></div>
                            </div>
                            <div class="profile-menu-info">
                                <span class="profile-display-name">{{ session.get('employee_name', 'Employee') }}</span>
                                <span class="profile-display-role">{{ session.get('employee_role', 'KWETU_EMPLOYEE')|replace('KWETU_', '') }}</span>
                            </div>
                            <i class="fas fa-chevron-down profile-menu-arrow"></i>
                        </button>
                        
                        <div id="profile-dropdown-menu" class="profile-dropdown-menu">
                            <div class="dropdown-header">
                                <div class="dropdown-user-info">
                                    <div class="dropdown-avatar">
                                        {% if session.get('employee_profile_picture') %}
                                            {% set profile_img = session.get('employee_profile_picture') %}
                                            {% if profile_img.startswith('uploads/') %}
                                                {% set profile_img_path = profile_img %}
                                            {% elif profile_img.startswith('profiles/') %}
                                                {% set profile_img_path = 'uploads/' + profile_img %}
                                            {% else %}
                                                {% set profile_img_path = 'uploads/profiles/' + profile_img %}
                                            {% endif %}
                                            <img src="{{ url_for('static', filename=profile_img_path) }}" alt="Profile" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                            <div class="avatar-placeholder" style="display: none;">
                                                <i class="fas fa-user"></i>
                                            </div>
                                        {% else %}
                                            <div class="avatar-placeholder">
                                                <i class="fas fa-user"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="dropdown-user-details">
                                        <p class="dropdown-user-name">{{ session.get('employee_name', 'Employee') }}</p>
                                        <p class="dropdown-user-email">{{ session.get('employee_email', 'employee@kwetu.com') }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="/dashboard/profile" class="dropdown-menu-item">
                                <div class="menu-item-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span class="menu-item-label">My Profile</span>
                                <i class="fas fa-chevron-right menu-item-arrow"></i>
                            </a>
                            <a href="/dashboard/settings" class="dropdown-menu-item">
                                <div class="menu-item-icon">
                                    <i class="fas fa-cog"></i>
                                </div>
                                <span class="menu-item-label">My Settings</span>
                                <i class="fas fa-chevron-right menu-item-arrow"></i>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="/api/logout" class="dropdown-menu-item logout-item">
                                <div class="menu-item-icon">
                                    <i class="fas fa-sign-out-alt"></i>
                                </div>
                                <span class="menu-item-label">Logout</span>
                                <i class="fas fa-chevron-right menu-item-arrow"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="dashboard-main-content" id="dashboard-main-content">
            {% block content %}{% endblock %}
        </main>
        
        <!-- Footer -->
        <footer class="dashboard-footer">
            <div class="footer-container">
                <div class="footer-left-section">
                    <div class="footer-copyright">
                        <p class="copyright-text">&copy; 2024 <strong>KWETU DELIVERIES</strong>. All rights reserved.</p>
                    </div>
                </div>
                <div class="footer-right-section">
                    <nav class="footer-nav">
                        <a href="/dashboard/help" class="footer-nav-link">
                            <i class="fas fa-question-circle"></i>
                            <span>Help</span>
                        </a>
                        <a href="/dashboard/support" class="footer-nav-link">
                            <i class="fas fa-headset"></i>
                            <span>Support</span>
                        </a>
                        <a href="/dashboard/privacy" class="footer-nav-link">
                            <i class="fas fa-shield-alt"></i>
                            <span>Privacy</span>
                        </a>
                    </nav>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
